# 定義在所有介面上監聽 3838 port
run_as shiny;

# 定義 server
server {
  listen 3838;

  # Define a location at the base URL
  location / {
    
    # 指向 Shiny app 的目錄
    site_dir /srv/shiny-server;
    
    # Log all Shiny output to files in this directory
    log_dir /var/log/shiny-server;
    
    # 當使用者訪問基礎 URL 時，重新導向到 myapp
    directory_index on;
  }

  # 為特定 app 定義位置
  location /myapp {
    app_dir /srv/shiny-server/myapp;
    log_dir /var/log/shiny-server;
    
    # 設定 app 啟動逾時時間
    app_init_timeout 60;
    app_idle_timeout 5;
  }
}

# 允許 shiny 使用者寫入 log 目錄
access_log /var/log/shiny-server/access.log default;

# 設定 websocket 支援
preserve_logs true;
